// ==UserScript==
// @name         Ch·∫∑n ƒë·∫øm th·ªùi gian LMS 360
// @namespace    http://tampermonkey.net/
// @version      3.0
// @description  Ch·∫∑n b·ªô ƒë·∫øm th·ªùi gian (B·∫≠t/T·∫Øt)
// @author       V Quan
// @match        *://lms360.edu.vn/*
// @grant        none
// ==/UserScript==

(function() {
    'use strict';

    let isEnabled = localStorage.getItem("vip_pro_max_status") === "true"; // L∆∞u tr·∫°ng th√°i b·∫≠t/t·∫Øt

    function blockTimers() {
        if (!isEnabled) return;

        console.log("[UserScript] ƒê√£ ch·∫∑n b·ªô ƒë·∫øm th·ªùi gian!");

        // Ghi ƒë√® setInterval v√† setTimeout
        window.setInterval = function() {
            console.log("[UserScript] Ch·∫∑n setInterval");
            return 0;
        };
        window.setTimeout = function() {
            console.log("[UserScript] Ch·∫∑n setTimeout");
            return 0;
        };

        // D·ª´ng t·∫•t c·∫£ timer ƒëang ch·∫°y
        for (let i = 1; i < 99999; i++) {
            clearInterval(i);
            clearTimeout(i);
        }

        // NgƒÉn ch·∫∑n visibilitychange (chuy·ªÉn tab kh√¥ng ·∫£nh h∆∞·ªüng)
        document.addEventListener("visibilitychange", function(event) {
            event.stopImmediatePropagation();
            console.log("[UserScript] Ch·∫∑n visibilitychange");
        }, true);

        // NgƒÉn ch·∫∑n c·∫£nh b√°o r·ªùi trang
        window.onbeforeunload = null;
        window.onunload = null;

        // Ch·∫∑n event beforeunload
        window.addEventListener("beforeunload", function(event) {
            event.stopImmediatePropagation();
            console.log("[UserScript] Ch·∫∑n beforeunload");
        }, true);

        // Ghi ƒë√® performance.now() ƒë·ªÉ lu√¥n tr·∫£ v·ªÅ 0
        performance.now = function() {
            console.log("[UserScript] Ch·∫∑n performance.now()");
            return 0;
        };
    }

    if (isEnabled) blockTimers(); // Ch·∫∑n ngay n·∫øu ƒëang b·∫≠t

    // T·∫°o UI hi·ªÉn th·ªã
    let div = document.createElement("div");
    div.innerHTML = `
        <div id="script-ui" style="
            position: fixed;
            top: 20px;
            left: 20px;
            width: 250px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px;
            font-size: 14px;
            border-radius: 8px;
            z-index: 9999;
            box-shadow: 0px 0px 15px rgba(255, 255, 255, 0.2);
            font-family: Arial, sans-serif;
        ">
            <b>üöÄ VIP PRO MAX</b> <br>
            ‚úÖ Tr·∫°ng th√°i: <span id="status">${isEnabled ? "ƒêang b·∫≠t" : "ƒê√£ t·∫Øt"}</span> <br>
            <button id="toggle-script" style="
                margin-top: 10px;
                width: 100%;
                background: ${isEnabled ? "red" : "green"};
                color: white;
                border: none;
                padding: 8px;
                cursor: pointer;
                border-radius: 5px;
            ">${isEnabled ? "T·∫Øt Script" : "B·∫≠t Script"}</button>
        </div>
    `;
    document.body.appendChild(div);

    // ·∫®n UI sau 10 gi√¢y (c√≥ th·ªÉ m·ªü l·∫°i)
    setTimeout(() => {
        div.style.opacity = "0.5"; // L√†m m·ªù thay v√¨ ·∫©n ho√†n to√†n
    }, 10000);

    // X·ª≠ l√Ω b·∫≠t/t·∫Øt script real-time
    document.getElementById("toggle-script").addEventListener("click", function() {
        isEnabled = !isEnabled;
        localStorage.setItem("vip_pro_max_status", isEnabled); // L∆∞u tr·∫°ng th√°i v√†o localStorage
        document.getElementById("status").innerText = isEnabled ? "ƒêang b·∫≠t" : "ƒê√£ t·∫Øt";
        this.innerText = isEnabled ? "T·∫Øt Script" : "B·∫≠t Script";
        this.style.background = isEnabled ? "red" : "green";

        if (isEnabled) {
            blockTimers();
        } else {
            location.reload(); // Reload trang n·∫øu t·∫Øt script
        }
    });

})();
